<div id="densitySelect">
    <input type="radio" id="loss1" name="loss" checked>
    <label for="loss1">\( \mathcal L_1 \)</label>
    <input type="radio" id="loss2" name="loss">
    <label for="loss2">\( \mathcal L_2  \)</label>
</div>
<div id="density"></div>

<div id="vector-phi1">\( \phi_1 \)</div>
<div id="vector-phi2">\( \phi_2 \)</div>
<div id="vector-phi3">\( \phi_3 \)</div>

<script>
    import * as d3 from 'd3';
    import { onMount } from 'svelte';
    import * as tf from '@tensorflow/tfjs'

    import { CoordinateConversions } from './util/CoordinateConversions.js'
    import { VectorGroup } from './util/VectorGroup.js'
    import { ContourPlot } from './util/ContourPlot.js'

    import { Random2DLinearRegressionLossSpace } from './util/LossSpace.js'
    import { Regression2DTaskGroup } from './util/TaskGroup.js'

    import { loss_4 as loss_1 } from './util/loss'

    const margin = { top: 20, right: 30, bottom: 30, left: 40 }
    const width = 600, height = 400
    const xrange = [0, 1], yrange = [0, 1]

    onMount(() => {
        var svg = d3.select('#density').append('svg')
            .attr("width", width)
            .attr("height", height)
            .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")")

        var coordinateConversions = new CoordinateConversions(svg, margin, width, height, xrange, yrange)

        var taskGroup = new Regression2DTaskGroup(svg, [.5, .5], [[.1, .1], [.7, .7]], .3, coordinateConversions)

        /*var densitySelect = d3.select('#densitySelect').append('select')
        densitySelect
            .selectAll('option')
            .data(taskGroup.getLossData())
            .enter()
            .append('option')
            .html(d => `\\( \\mathcal{L}_${d.index} \\)`)
        */

        var contour = new ContourPlot(svg, coordinateConversions)
        contour.prerender(taskGroup.tasks.map(t => t.loss))
        contour.render(0)

        var options = ["loss1", "loss2"]
        options.forEach((id, i) => {
            document.getElementById(id).onchange = () => {
                if (document.getElementById(id).value == "on") {
                    contour.rerender(i)
                }
            }
        })

        taskGroup.declare([
            'vector-phi1',
            'vector-phi2'
        ]).animate()

        coordinateConversions.displayAxes()
    })
</script>